{
  "hash": "6f8eafe9ae7b48e457c6fef5d08a40ae",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Exercise Week 2: Solutions\"\nexecute:\n  echo: true\nformat:\n  html:\n    toc: true\n    toc_depth: 1\n    toc-floating: true\n    toc-location: left\n    toc-title: Exercise\n    number_sections: false\n---\n\n\n\n# fpp3 2.10, Ex 1\n\n> Explore the following four time series: `Bricks` from `aus_production`, `Lynx` from `pelt`, `Close` from `gafa_stock`, `Demand` from `vic_elec`.\n>\n>   + Use `?` (or `help()`) to find out about the data in each series.\n>   + What is the time interval of each series?\n>   + Use `autoplot()` to produce a time plot of each series.\n>   + For the last plot, modify the axis labels and title.\n\n## Bricks\n\n\n::: {.cell}\n\n```{.r .cell-code}\naus_production\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 218 x 7 [1Q]\n   Quarter  Beer Tobacco Bricks Cement Electricity   Gas\n     <qtr> <dbl>   <dbl>  <dbl>  <dbl>       <dbl> <dbl>\n 1 1956 Q1   284    5225    189    465        3923     5\n 2 1956 Q2   213    5178    204    532        4436     6\n 3 1956 Q3   227    5297    208    561        4806     7\n 4 1956 Q4   308    5681    197    570        4418     6\n 5 1957 Q1   262    5577    187    529        4339     5\n 6 1957 Q2   228    5651    214    604        4811     7\n 7 1957 Q3   236    5317    227    603        5259     7\n 8 1957 Q4   320    6152    222    582        4735     6\n 9 1958 Q1   272    5758    199    554        4608     5\n10 1958 Q2   233    5641    229    620        5196     7\n# ℹ 208 more rows\n```\n\n\n:::\n:::\n\n\nThe observations are quarterly.\n\n\n::: {.cell}\n\n```{.r .cell-code}\naus_production |> autoplot(Bricks)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\nAn upward trend is apparent until 1980, after which the number of clay bricks being produced starts to decline. A seasonal pattern is evident in this data. Some sharp drops in some quarters can also be seen.\n\n## Lynx\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninterval(pelt)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<interval[1]>\n[1] 1Y\n```\n\n\n:::\n:::\n\n\nObservations are made once per year.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npelt |> autoplot(Lynx)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nCanadian lynx trappings are cyclic, as the extent of peak trappings is unpredictable, and the spacing between the peaks is irregular but approximately 10 years.\n\n## Close\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngafa_stock\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 5,032 x 8 [!]\n# Key:       Symbol [4]\n   Symbol Date        Open  High   Low Close Adj_Close    Volume\n   <chr>  <date>     <dbl> <dbl> <dbl> <dbl>     <dbl>     <dbl>\n 1 AAPL   2014-01-02  79.4  79.6  78.9  79.0      67.0  58671200\n 2 AAPL   2014-01-03  79.0  79.1  77.2  77.3      65.5  98116900\n 3 AAPL   2014-01-06  76.8  78.1  76.2  77.7      65.9 103152700\n 4 AAPL   2014-01-07  77.8  78.0  76.8  77.1      65.4  79302300\n 5 AAPL   2014-01-08  77.0  77.9  77.0  77.6      65.8  64632400\n 6 AAPL   2014-01-09  78.1  78.1  76.5  76.6      65.0  69787200\n 7 AAPL   2014-01-10  77.1  77.3  75.9  76.1      64.5  76244000\n 8 AAPL   2014-01-13  75.7  77.5  75.7  76.5      64.9  94623200\n 9 AAPL   2014-01-14  76.9  78.1  76.8  78.1      66.1  83140400\n10 AAPL   2014-01-15  79.1  80.0  78.8  79.6      67.5  97909700\n# ℹ 5,022 more rows\n```\n\n\n:::\n:::\n\n\nInterval is daily. Looking closer at the data, we can see that the index is a Date variable. It also appears that observations occur only on trading days, creating lots of implicit missing values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngafa_stock |>\n  autoplot(Close)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nStock prices for these technology stocks have risen for most of the series, until mid-late 2018.\n\nThe four stocks are on different scales, so they are not directly comparable. A plot with faceting would be better.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngafa_stock |>\n  ggplot(aes(x=Date, y=Close, group=Symbol)) +\n  geom_line(aes(col=Symbol)) +\n  facet_grid(Symbol ~ ., scales='free')\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nThe downturn in the second half of 2018 is now very clear, with Facebook taking a big drop (about 20%) in the middle of the year.\n\nThe stocks tend to move roughly together, as you would expect with companies in the same industry.\n\n## Demand\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvic_elec\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 52,608 x 5 [30m] <Australia/Melbourne>\n   Time                Demand Temperature Date       Holiday\n   <dttm>               <dbl>       <dbl> <date>     <lgl>  \n 1 2012-01-01 00:00:00  4383.        21.4 2012-01-01 TRUE   \n 2 2012-01-01 00:30:00  4263.        21.0 2012-01-01 TRUE   \n 3 2012-01-01 01:00:00  4049.        20.7 2012-01-01 TRUE   \n 4 2012-01-01 01:30:00  3878.        20.6 2012-01-01 TRUE   \n 5 2012-01-01 02:00:00  4036.        20.4 2012-01-01 TRUE   \n 6 2012-01-01 02:30:00  3866.        20.2 2012-01-01 TRUE   \n 7 2012-01-01 03:00:00  3694.        20.1 2012-01-01 TRUE   \n 8 2012-01-01 03:30:00  3562.        19.6 2012-01-01 TRUE   \n 9 2012-01-01 04:00:00  3433.        19.1 2012-01-01 TRUE   \n10 2012-01-01 04:30:00  3359.        19.0 2012-01-01 TRUE   \n# ℹ 52,598 more rows\n```\n\n\n:::\n:::\n\n\nData is available at 30 minute intervals.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvic_elec |>\n  autoplot(Demand)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nAppears to have an annual seasonal pattern, where demand is higher during summer and winter. Can't see much detail, so let's zoom in.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvic_elec |>\n  filter(yearmonth(Time) == yearmonth(\"2012 June\")) |>\n  autoplot(Demand)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nAppears to have a daily pattern, where less electricity is used overnight. Also appears to have a working day effect (less demand on weekends and holidays).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvic_elec |> autoplot(Demand/1e3) +\n  labs(\n    x = \"Date\",\n    y = \"Demand (GW)\",\n    title = \"Half-hourly electricity demand\",\n    subtitle = \"Victoria, Australia\"\n  )\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\nHere the annual seasonality is clear, with high volatility in summer, and peaks in summer and winter. The weekly seasonality is also visible, but the daily seasonality is hidden due to the compression on the horizontal axis.\n\n# fpp3 2.10, Ex 2\n\n> Use `filter()` to find what days corresponded to the peak closing price for each of the four stocks in `gafa_stock`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngafa_stock |>\n  group_by(Symbol) |>\n  filter(Close == max(Close)) |>\n  ungroup() |>\n  select(Symbol, Date, Close)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 4 x 3 [!]\n# Key:       Symbol [4]\n  Symbol Date       Close\n  <chr>  <date>     <dbl>\n1 AAPL   2018-10-03  232.\n2 AMZN   2018-09-04 2040.\n3 FB     2018-07-25  218.\n4 GOOG   2018-07-26 1268.\n```\n\n\n:::\n:::\n\n\n# fpp3 2.10, Ex 3\n\n> Download the file `tute1.csv` from [the book website](http://OTexts.com/fpp3/extrafiles/tute1.csv), open it in Excel (or some other spreadsheet application), and review its contents. You should find four columns of information. Columns B through D each contain a quarterly series, labelled Sales, AdBudget and GDP. Sales contains the quarterly sales for a small company over the period 1981-2005. AdBudget is the advertising budget and GDP is the gross domestic product. All series have been adjusted for inflation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndownload.file(\"http://OTexts.com/fpp3/extrafiles/tute1.csv\",\n              tute1 <- tempfile())\ntute1 <- readr::read_csv(tute1)\nView(tute1)\nmytimeseries <- tute1 |>\n  mutate(Quarter = yearquarter(Quarter)) |>\n  as_tsibble(index = Quarter)\n\nmytimeseries |>\n  pivot_longer(-Quarter, names_to=\"Key\", values_to=\"Value\") |>\n  ggplot(aes(x = Quarter, y = Value, colour = Key)) +\n    geom_line() +\n    facet_grid(vars(Key), scales = \"free_y\")\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Without faceting:\nmytimeseries |>\n  pivot_longer(-Quarter, names_to=\"Key\", values_to=\"Value\") |>\n  ggplot(aes(x = Quarter, y = Value, colour = Key)) +\n    geom_line()\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-13-2.png){width=672}\n:::\n:::\n\n\n# fpp3 2.10, Ex 4\n\n> The `USgas` package contains data on the demand for natural gas in the US.\n\n>    a. Install the `USgas` package.\n>    b. Create a tsibble from `us_total` with year as the index and state as the key.\n>    c. Plot the annual natural gas consumption by state for the New England area (comprising the states of Maine, Vermont, New Hampshire, Massachusetts, Connecticut and Rhode Island).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"USgas\", repos = \"https://cran.ms.unimelb.edu.au/\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nThe following package(s) will be installed:\n- USgas [0.1.2]\nThese packages will be installed into \"~/git/Teaching/af/renv/library/linux-neon-noble/R-4.5/x86_64-pc-linux-gnu\".\n\n# Installing packages --------------------------------------------------------\n- Installing USgas ...                          OK [linked from cache]\nSuccessfully installed 1 package in 13 milliseconds.\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(USgas)\nus_tsibble <- us_total |>\n  as_tsibble(index=year, key=state)\n# For each state\nus_tsibble |>\n  filter(state %in% c(\"Maine\", \"Vermont\", \"New Hampshire\", \"Massachusetts\",\n                      \"Connecticut\", \"Rhode Island\")) |>\n  autoplot(y/1e3) +\n  labs(y = \"billion cubic feet\")\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n# fpp3 2.10, Ex 5\n\n> a. Download `tourism.xlsx` from [the book website](http://OTexts.com/fpp3/extrafiles/tourism.xlsx) and read it into R using `read_excel()` from the `readxl` package.\n> b. Create a tsibble which is identical to the `tourism` tsibble from the `tsibble` package.\n> c. Find what combination of `Region` and `Purpose` had the maximum number of overnight trips on average.\n> d. Create a new tsibble which combines the Purposes and Regions, and just has total trips by State.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndownload.file(\"http://OTexts.com/fpp3/extrafiles/tourism.xlsx\",\n              tourism_file <- tempfile(), mode = \"wb\")\nmy_tourism <- readxl::read_excel(tourism_file) |>\n  mutate(Quarter = yearquarter(Quarter)) |>\n  as_tsibble(\n    index = Quarter,\n    key = c(Region, State, Purpose)\n  )\nmy_tourism\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 24,320 x 5 [1Q]\n# Key:       Region, State, Purpose [304]\n   Quarter Region   State           Purpose  Trips\n     <qtr> <chr>    <chr>           <chr>    <dbl>\n 1 1998 Q1 Adelaide South Australia Business  135.\n 2 1998 Q2 Adelaide South Australia Business  110.\n 3 1998 Q3 Adelaide South Australia Business  166.\n 4 1998 Q4 Adelaide South Australia Business  127.\n 5 1999 Q1 Adelaide South Australia Business  137.\n 6 1999 Q2 Adelaide South Australia Business  200.\n 7 1999 Q3 Adelaide South Australia Business  169.\n 8 1999 Q4 Adelaide South Australia Business  134.\n 9 2000 Q1 Adelaide South Australia Business  154.\n10 2000 Q2 Adelaide South Australia Business  169.\n# ℹ 24,310 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\ntourism\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 24,320 x 5 [1Q]\n# Key:       Region, State, Purpose [304]\n   Quarter Region   State           Purpose  Trips\n     <qtr> <chr>    <chr>           <chr>    <dbl>\n 1 1998 Q1 Adelaide South Australia Business  135.\n 2 1998 Q2 Adelaide South Australia Business  110.\n 3 1998 Q3 Adelaide South Australia Business  166.\n 4 1998 Q4 Adelaide South Australia Business  127.\n 5 1999 Q1 Adelaide South Australia Business  137.\n 6 1999 Q2 Adelaide South Australia Business  200.\n 7 1999 Q3 Adelaide South Australia Business  169.\n 8 1999 Q4 Adelaide South Australia Business  134.\n 9 2000 Q1 Adelaide South Australia Business  154.\n10 2000 Q2 Adelaide South Australia Business  169.\n# ℹ 24,310 more rows\n```\n\n\n:::\n\n```{.r .cell-code}\nmy_tourism |>\n  as_tibble() |>\n  summarise(Trips = mean(Trips), .by=c(Region, Purpose)) |>\n  filter(Trips == max(Trips))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 3\n  Region Purpose  Trips\n  <chr>  <chr>    <dbl>\n1 Sydney Visiting  747.\n```\n\n\n:::\n\n```{.r .cell-code}\nstate_tourism <- my_tourism |>\n  group_by(State) |>\n  summarise(Trips = sum(Trips)) |>\n  ungroup()\nstate_tourism\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 640 x 3 [1Q]\n# Key:       State [8]\n   State Quarter Trips\n   <chr>   <qtr> <dbl>\n 1 ACT   1998 Q1  551.\n 2 ACT   1998 Q2  416.\n 3 ACT   1998 Q3  436.\n 4 ACT   1998 Q4  450.\n 5 ACT   1999 Q1  379.\n 6 ACT   1999 Q2  558.\n 7 ACT   1999 Q3  449.\n 8 ACT   1999 Q4  595.\n 9 ACT   2000 Q1  600.\n10 ACT   2000 Q2  557.\n# ℹ 630 more rows\n```\n\n\n:::\n:::\n\n\n# fpp3 2.10, Ex 6\n\n> The `aus_arrivals` data set comprises quarterly international arrivals (in thousands) to Australia from Japan, New Zealand, UK and the US. Use `autoplot()`, `gg_season()` and `gg_subseries()` to compare the differences between the arrivals from these four countries. Can you identify any unusual observations?\n\n\n::: {.cell}\n\n```{.r .cell-code}\naus_arrivals |> autoplot(Arrivals)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\nGenerally the number of arrivals to Australia is increasing over the entire series, with the exception of Japanese visitors which begin to decline after 1995. The series appear to have a seasonal pattern which varies proportionately to the number of arrivals. Interestingly, the number of visitors from NZ peaks sharply in 1988. The seasonal pattern from Japan appears to change substantially.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#! fig-height: 10\naus_arrivals |> gg_season(Arrivals, labels = \"both\")\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\nThe seasonal pattern of arrivals appears to vary between each country. In particular, arrivals from the UK appears to be lowest in Q2 and Q3, and increase substantially for Q4 and Q1. Whereas for NZ visitors, the lowest period of arrivals is in Q1, and highest in Q3. Similar variations can be seen for Japan and US.\n\n\n::: {.cell}\n\n```{.r .cell-code}\naus_arrivals |> gg_subseries(Arrivals)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\nThe subseries plot reveals more interesting features. It is evident that whilst the UK arrivals is increasing, most of this increase is seasonal. More arrivals are coming during Q1 and Q4, whilst the increase in Q2 and Q3 is less extreme. The growth in arrivals from NZ and US appears fairly similar across all quarters. There exists an unusual spike in arrivals from the US in 1992 Q3.\n\nUnusual observations:\n\n  - 2000 Q3: Spikes from the US (Sydney Olympics arrivals)\n  - 2001 Q3-Q4 are unusual for US (9/11 effect)\n  - 1991 Q3 is unusual for the US (Gulf war effect?)\n\n# fpp3 2.10, Ex 7\n\n> Monthly Australian retail data is provided in aus_retail. Select one of the time series as follows (but choose your own seed value):\n>\n>    ```r\n>    set.seed(12345678)\n>    myseries <- aus_retail |>\n>      filter(`Series ID` == sample(aus_retail$`Series ID`,1))\n>    ```\n>\n> Explore your chosen retail time series using the following functions:\n>\n>    ```r\n>    autoplot(), gg_season(), gg_subseries(), gg_lag(), ACF() |> autoplot()\n>    ```\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(12345678)\nmyseries <- aus_retail |>\n  filter(`Series ID` == sample(aus_retail$`Series ID`,1))\nmyseries |>\n  autoplot(Turnover) +\n  labs(y = \"Turnover (million $AUD)\", x = \"Time (Years)\",\n       title = myseries$Industry[1],\n       subtitle = myseries$State[1])\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/ex6-1.png){width=672}\n:::\n:::\n\n\nThe data features a non-linear upward trend and a strong seasonal pattern. The variability in the data appears proportional to the amount of turnover (level of the series) over the time period.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmyseries |>\n  gg_season(Turnover, labels = \"both\") +\n  labs(y = \"Turnover (million $AUD)\",\n       title = myseries$Industry[1],\n       subtitle = myseries$State[1])\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\nStrong seasonality is evident in the season plot. Large increases in clothing retailing can be observed in December (probably a Christmas effect). There is also a peak in July that appears to be getting stronger over time. 2016 had an unusual pattern in the first half of the year.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmyseries |>\n  gg_subseries(Turnover) +\n  labs(y = \"Turnover (million $AUD)\", x=\"\")\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\nThere is a strong trend in all months, with the largest trend in December and a larger increase in July and August than most other months.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmyseries |>\n  gg_lag(Turnover, lags=1:24, geom='point') + facet_wrap(~ .lag, ncol=6)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n\n```{.r .cell-code}\nmyseries |>\n  ACF(Turnover, lag_max = 50) |>\n  autoplot()\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-21-2.png){width=672}\n:::\n:::\n\n\n# fpp3 2.10, Ex 8\n\n> Use the following graphics functions: `autoplot()`, `gg_season()`, `gg_subseries()`, `gg_lag()`, `ACF()` and explore features from the following time series: \"Total Private\" `Employed` from `us_employment`, `Bricks` from `aus_production`, `Hare` from `pelt`, \"H02\" `Cost` from `PBS`, and `us_gasoline`.\n>\n>    + Can you spot any seasonality, cyclicity and trend?\n>    + What do you learn about the series?\n>    + What can you say about the seasonal patterns?\n>    + Can you identify any unusual years?\n\n## Total Private Employment in the US\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_employment |>\n  filter(Title == \"Total Private\") |>\n  autoplot(Employed)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\nThere is a strong trend and seasonality. Some cyclic behaviour is seen, with a big drop due to the global financial crisis.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_employment |>\n  filter(Title == \"Total Private\") |>\n  gg_season(Employed)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_employment |>\n  filter(Title == \"Total Private\") |>\n  gg_subseries(Employed)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_employment |>\n  filter(Title == \"Total Private\") |>\n  gg_lag(Employed)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_employment |>\n  filter(Title == \"Total Private\") |>\n  ACF(Employed) |>\n  autoplot()\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\nIn all of these plots, the trend is so dominant that it is hard to see anything else. We need to remove the trend so we can explore the other features of the data.\n\n## Brick production in Australia\n\n\n::: {.cell}\n\n```{.r .cell-code}\naus_production |>\n  autoplot(Bricks)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-27-1.png){width=672}\n:::\n:::\n\n\nA positive trend in the first 20 years, and a negative trend in the next 25 years. Strong quarterly seasonality, with some cyclicity -- note the recessions in the 1970s and 1980s.\n\n\n::: {.cell}\n\n```{.r .cell-code}\naus_production |>\n  gg_season(Bricks)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-28-1.png){width=672}\n:::\n:::\n\n\nBrick production tends to be lowest in the first quarter and peak in either quarter 2 or quarter 3.\n\n\n::: {.cell}\n\n```{.r .cell-code}\naus_production |>\n  gg_subseries(Bricks)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n:::\n\n\nThe decrease in the last 25 years has been weakest in Q1.\n\n\n::: {.cell}\n\n```{.r .cell-code}\naus_production |>\n  gg_lag(Bricks, geom='point')\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n\n```{.r .cell-code}\naus_production |>\n  ACF(Bricks) |> autoplot()\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-30-2.png){width=672}\n:::\n:::\n\n\nThe seasonality shows up as peaks at lags 4, 8, 12, 16, 20, .... The trend is seen with the slow decline on the positive side.\n\n## Snow hare trappings in Canada\n\n\n::: {.cell}\n\n```{.r .cell-code}\npelt |>\n  autoplot(Hare)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-31-1.png){width=672}\n:::\n:::\n\n\nThere is some cyclic behaviour with substantial variation in the length of the period.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npelt |>\n  gg_lag(Hare, geom='point')\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n\n```{.r .cell-code}\npelt |>\n  ACF(Hare) |> autoplot()\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-32-2.png){width=672}\n:::\n:::\n\n\nThe cyclic period seems to have an average of about 10 (due to the local maximum in ACF at lag 10).\n\n## H02 sales in Australia\n\nThere are four series corresponding to H02 sales, so we will add them together.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nh02 <- PBS |>\n  filter(ATC2 == \"H02\") |>\n  group_by(ATC2) |>\n  summarise(Cost = sum(Cost)) |>\n  ungroup()\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nh02 |>\n  autoplot(Cost)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-34-1.png){width=672}\n:::\n:::\n\n\nA positive trend with strong monthly seasonality, dropping suddenly every February.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nh02 |>\n  gg_season(Cost)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nh02 |>\n  gg_subseries(Cost)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n:::\n\n\nThe trends have been greater in the higher peaking months -- this leads to increasing seasonal variation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nh02 |>\n  gg_lag(Cost, geom='point', lags=1:16)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-37-1.png){width=672}\n:::\n\n```{.r .cell-code}\nh02 |>\n  ACF(Cost) |> autoplot()\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-37-2.png){width=672}\n:::\n:::\n\n\nThe large January sales show up as a separate cluster of points in the lag plots. The strong seasonality is clear in the ACF plot.\n\n## US gasoline sales\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_gasoline |>\n  autoplot(Barrels)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-38-1.png){width=672}\n:::\n:::\n\n\nA positive trend until 2008, and then the global financial crisis led to a drop in sales until 2012. The shape of the seasonality seems to have changed over time.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_gasoline |>\n  gg_season(Barrels)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-39-1.png){width=672}\n:::\n:::\n\n\nThere is a lot of noise making it hard to see the overall seasonal pattern. However, it seems to drop towards the end of quarter 4.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_gasoline |>\n  gg_subseries(Barrels)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-40-1.png){width=672}\n:::\n:::\n\n\nThe blue lines are helpful in seeing the average seasonal pattern.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus_gasoline |>\n  gg_lag(Barrels, geom='point', lags=1:16)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-41-1.png){width=672}\n:::\n\n```{.r .cell-code}\nus_gasoline |>\n  ACF(Barrels, lag_max = 150) |> autoplot()\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-41-2.png){width=672}\n:::\n:::\n\n\nThe seasonality is seen if we increase the lags to at least 2 years (approx 104 weeks)\n\n# fpp3 2.10, Ex 9\n\n> The following time plots and ACF plots correspond to four different time series. Your task is to match each time plot in the first row with one of the ACF plots in the second row.\n\n![](https://otexts.com/fpp3/fpp_files/figure-html/acfguess-1.png)\n\n1-B, 2-A, 3-D, 4-C\n\n# fpp3 2.10, Ex 10\n\n> The `aus_livestock` data contains the monthly total number of pigs slaughtered in Victoria, Australia, from Jul 1972 to Dec 2018. Use `filter()` to extract pig slaughters in Victoria between 1990 and 1995. Use `autoplot` and `ACF` for this data. How do they differ from white noise? If a longer period of data is used, what difference does it make to the ACF?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvic_pigs <- aus_livestock |>\n  filter(Animal == \"Pigs\", State == \"Victoria\", between(year(Month), 1990, 1995))\nvic_pigs\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 72 x 4 [1M]\n# Key:       Animal, State [1]\n      Month Animal State    Count\n      <mth> <fct>  <fct>    <dbl>\n 1 1990 Jan Pigs   Victoria 76000\n 2 1990 Feb Pigs   Victoria 78100\n 3 1990 Mar Pigs   Victoria 77600\n 4 1990 Apr Pigs   Victoria 84100\n 5 1990 May Pigs   Victoria 98000\n 6 1990 Jun Pigs   Victoria 89100\n 7 1990 Jul Pigs   Victoria 93500\n 8 1990 Aug Pigs   Victoria 84700\n 9 1990 Sep Pigs   Victoria 74500\n10 1990 Oct Pigs   Victoria 91900\n# ℹ 62 more rows\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvic_pigs |>\n  autoplot(Count)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-43-1.png){width=672}\n:::\n:::\n\n\nAlthough the values appear to vary erratically between months, a general upward trend is evident between 1990 and 1995. In contrast, a white noise plot does not exhibit any trend.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvic_pigs |> ACF(Count) |> autoplot()\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-44-1.png){width=672}\n:::\n:::\n\n\nThe first 14 lags are significant, as the ACF slowly decays. This suggests that the data contains a trend. A white noise ACF plot would not usually contain any significant lags. The large spike at lag 12 suggests there is some seasonality in the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\naus_livestock |>\n  filter(Animal == \"Pigs\", State == \"Victoria\") |>\n  ACF(Count) |>\n  autoplot()\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-45-1.png){width=672}\n:::\n:::\n\n\nThe longer series has much larger autocorrelations, plus clear evidence of seasonality at the seasonal lags of $12, 24, \\dots$.\n\n# fpp3 2.10, Ex 11\n\n> a. Use the following code to compute the daily changes in Google closing stock prices.\n>\n>      ```r\n>      dgoog <- gafa_stock |>\n>        filter(Symbol == \"GOOG\", year(Date) >= 2018) |>\n>        mutate(trading_day = row_number()) |>\n>        update_tsibble(index = trading_day, regular = TRUE) |>\n>        mutate(diff = difference(Close))\n>      ```\n>\n> b. Why was it necessary to re-index the tsibble?\n> c. Plot these differences and their ACF.\n> d. Do the changes in the stock prices look like white noise?\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndgoog <- gafa_stock |>\n  filter(Symbol == \"GOOG\", year(Date) >= 2018) |>\n  mutate(trading_day = row_number()) |>\n  update_tsibble(index = trading_day, regular = TRUE) |>\n  mutate(diff = difference(Close))\n```\n:::\n\n\nThe tsibble needed re-indexing as trading happens irregularly. The new index is based only on trading days.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndgoog |> autoplot(diff)\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-47-1.png){width=672}\n:::\n\n```{.r .cell-code}\ndgoog |> ACF(diff, lag_max=100) |> autoplot()\n```\n\n::: {.cell-output-display}\n![](ex2-sol_files/figure-html/unnamed-chunk-47-2.png){width=672}\n:::\n:::\n\n\nThere are some small significant autocorrelations out to lag 24, but nothing after that. Given the probability of a false positive is 5%, these look similar to white noise.\n",
    "supporting": [
      "ex2-sol_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}